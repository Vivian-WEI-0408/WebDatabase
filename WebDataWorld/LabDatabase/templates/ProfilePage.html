<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>用户主页 - 基因组装平台</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f9fc;
            color: #333;
            line-height: 1.6;
        }
        
        .app-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* 左侧边栏样式 */
        .sidebar {
            width: 280px;
            background: linear-gradient(to bottom, #1a6a9e, #2a8bc5);
            color: white;
            padding: 0;
            overflow-y: auto;
            box-shadow: 3px 0 15px rgba(0, 0, 0, 0.1);
            z-index: 10;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-header {
            padding: 25px 20px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .sidebar-header h1 {
            font-size: 22px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .sidebar-header i {
            font-size: 24px;
        }
        
        /* 用户资料部分 */
        .profile-section {
            padding: 25px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s;
            padding: 10px;
            border-radius: 8px;
        }
        
        .profile-header:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .profile-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 15px;
        }
        
        .profile-info h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .profile-info p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* 导航菜单 */
        .nav-menu {
            flex: 1;
            padding: 20px 0;
            overflow-y: auto;
        }
        
        .nav-item {
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            border-left: 4px solid transparent;
        }
        
        .nav-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .nav-item.active {
            background-color: rgba(255, 255, 255, 0.15);
            border-left-color: #ff9800;
        }
        
        .nav-item i {
            width: 24px;
            margin-right: 12px;
            font-size: 18px;
        }

        .nav-item a{
            color: white;
            text-decoration: none;
            font-size: 16px;
            font-weight: 500;
        }
        
        .nav-item span {
            font-size: 16px;
            font-weight: 500;
        }
        
        /* 可展开的仓库列表 */
        .warehouse-nav {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
            background-color: rgba(0, 0, 0, 0.1);
        }
        
        .warehouse-nav.expanded {
            max-height: 400px;
        }
        
        .warehouse-subitem {
            padding: 12px 20px 12px 55px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            border-left: 4px solid transparent;
            font-size: 15px;
        }
        
        .warehouse-subitem:hover {
            background-color: rgba(255, 255, 255, 0.08);
        }
        
        .warehouse-subitem.active {
            background-color: rgba(255, 255, 255, 0.1);
            border-left-color: #4caf50;
        }
        
        .warehouse-subitem i {
            width: 20px;
            margin-right: 10px;
            font-size: 14px;
        }
        
        /* 侧边栏底部 */
        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .sidebar-btn {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 12px 15px;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
        }
        
        .sidebar-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        /* 主内容区样式 */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background-color: #f8fafc;
        }
        
        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .content-header h2 {
            color: #1a6a9e;
            font-size: 28px;
            font-weight: 600;
        }
        
        .content-subtitle {
            color: #64748b;
            font-size: 16px;
            margin-top: 5px;
        }
        
        /* 内容卡片 */
        .content-card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .card-title {
            font-size: 22px;
            font-weight: 600;
            color: #1a6a9e;
        }
        
        /* 用户资料卡片样式 */
        .profile-details {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }
        
        .detail-group {
            margin-bottom: 20px;
        }
        
        .detail-label {
            font-weight: 600;
            color: #64748b;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .detail-value {
            font-size: 16px;
            color: #333;
            padding: 10px 15px;
            background-color: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        /* 统计卡片 */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: linear-gradient(to right, #2a8bc5, #3b9cd9);
            color: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(42, 139, 197, 0.3);
        }
        
        .stat-card.green {
            background: linear-gradient(to right, #4caf50, #66bb6a);
        }
        
        .stat-card.orange {
            background: linear-gradient(to right, #ff9800, #ffb74d);
        }
        
        .stat-card.purple {
            background: linear-gradient(to right, #9c27b0, #ba68c8);
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* 仓库卡片 */
        .warehouse-card {
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            background-color: white;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .warehouse-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-color: #cbd5e1;
        }
        
        .warehouse-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .warehouse-name {
            font-weight: 600;
            font-size: 18px;
            color: #1a6a9e;
        }
        
        .warehouse-id {
            background-color: #f0f7ff;
            color: #2a8bc5;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 13px;
        }
        
        .warehouse-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .warehouse-stat {
            display: flex;
            align-items: center;
            font-size: 14px;
            color: #64748b;
        }
        
        .warehouse-stat i {
            margin-right: 8px;
            color: #94a3b8;
        }
        
        .warehouse-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }
        
        .warehouse-tag {
            background-color: #f1f5f9;
            color: #64748b;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
        }
        
        /* 空状态 */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #94a3b8;
        }
        
        .empty-state i {
            font-size: 50px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 10px;
            color: #64748b;
        }
        
        /* 响应式设计 */
        @media (max-width: 1024px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                max-height: 400px;
            }
            
            .warehouse-nav.expanded {
                max-height: 300px;
            }
        }
        
        @media (max-width: 768px) {
            .main-content {
                padding: 20px;
            }
            
            .profile-details {
                grid-template-columns: 1fr;
            }
            
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .content-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
        }
        
        /* 动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        /* 滚动条样式 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        
        /* 切换箭头 */
        .nav-arrow {
            margin-left: auto;
            transition: transform 0.3s;
        }
        
        .nav-arrow.rotated {
            transform: rotate(90deg);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- 左侧边栏 -->
        <div class="sidebar">
            <div class="sidebar-header">
                <i class="fas fa-dna"></i>
                <h1>基因组装平台</h1>
            </div>
            
            <!-- 用户资料部分 -->
            <div class="profile-section">
                <div class="profile-header" id="profile-header">
                    <div class="profile-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="profile-info">
                        <h3>{{user.uname}}</h3>
                        <!-- <p>{{user.group}}</p> -->
                    </div>
                </div>
            </div>
            
            <!-- 导航菜单 -->
            <div class="nav-menu">
                <div class="nav-item active" data-content="dashboard">
                    <a href="#" data-tool = "dashboard"><span><i class="fas fa-home"></i>仪表盘</span></a>
                </div>
                
                <div class="nav-item" data-content="profile">
                    <a href="#" data-tool = "profile"><span><i class="fas fa-user-circle"></i>个人资料</span></a>
                    
                </div>
                
                <div class="nav-item" id="warehouse-nav">
                    <a href="#" data-tool="warehouse"><span><i class="fas fa-warehouse"></i>组装仓库</span></a>
                    <i class="fas fa-chevron-right nav-arrow"></i>
                </div>
                
                <!-- 可展开的仓库列表 -->
                <div class="warehouse-nav" id="warehouse-list">
                    <!-- 仓库子项将通过JavaScript动态生成 -->
                </div>
                
                <div class="nav-item" data-content="privateDatabase">
                    <a href="#" data-tool="privateDatabase"><span><i class="fas fa-flask"></i>私人数据库</span></a>
                </div>
                
                <div class="nav-item" data-content="templates">
                    <a href="#" data-tool = "templates"><span><i class="fas fa-clone"></i>组装模板</span></a>
                </div>
                
                <div class="nav-item" data-content="tools">
                    <a href="#" data-tool="tools"><span><i class="fas fa-tools"></i>工具</span></a>
                </div>
                
                <div class="nav-item" data-content="settings">
                    <a href="#" data-tool="settings"><span> <i class="fas fa-cog"></i>设置</span></a>
                </div>
            </div>
            
            <!-- 侧边栏底部 -->
            <div class="sidebar-footer">
                <button class="sidebar-btn" id="logout-btn">
                    <i class="fas fa-sign-out-alt"></i> 退出登录
                </button>
            </div>
        </div>
        
        <!-- 主内容区 -->
        <div class="main-content">
            <!-- 仪表盘内容 -->
            <div class="content-section" style="display: block;" id="dashboard-content">
                <div class="content-header">
                    <div>
                        <h2>欢迎回来，{{user.uname}}！</h2>
                        <p class="content-subtitle">以下是您的工作统计和最近活动</p>
                    </div>
                    <!-- <div>
                        <button class="sidebar-btn" style="background-color: #2a8bc5; color: white; width: auto;">
                            <i class="fas fa-plus"></i> 新建项目
                        </button>
                    </div> -->
                </div>
                
                <div class="stats-container">
                    <div class="stat-card fade-in">
                        <div class="stat-value" id="warehouse-count">{{user_info.repoCount}}</div>
                        <div class="stat-label">组装仓库</div>
                    </div>
                    
                    <!-- <div class="stat-card green fade-in">
                        <div class="stat-value" id="project-count">12</div>
                        <div class="stat-label">进行中项目</div>
                    </div> -->
                    
                    <div class="stat-card orange fade-in">
                        <div class="stat-value" id="component-count">{{user_info.partCount}}</div>
                        <div class="stat-label">基因元件</div>
                    </div>

                    <div class="stat-card green fade-in">
                        <div class="stat-value" id="backbone-count">{{user_info.backboneCount}}</div>
                        <div class="stat-label">已上传载体</div>
                    </div>
                    
                    <div class="stat-card purple fade-in">
                        <div class="stat-value" id="plasmid-count">{{user_info.plasmidCount}}</div>
                        <div class="stat-label">已构建质粒</div>
                    </div>
                </div>
                
                <div class="content-card fade-in" style="margin-top: 30px;">
                    <div class="card-header">
                        <div class="card-title">最近活动</div>
                        <button class="sidebar-btn" style="background-color: transparent; color: #2a8bc5; width: auto; padding: 8px 15px;">
                            查看全部 <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                    
                    <div class="activity-list">
                        <div class="warehouse-card fade-in">
                            <div class="warehouse-card-header">
                                <div class="warehouse-name">新质粒构建完成</div>
                                <div class="warehouse-id">2小时前</div>
                            </div>
                            <p>成功构建质粒 pEGFP-N1-CMV-GFP，已添加到"哺乳动物表达载体库"</p>
                        </div>
                        
                        <div class="warehouse-card fade-in">
                            <div class="warehouse-card-header">
                                <div class="warehouse-name">新仓库创建</div>
                                <div class="warehouse-id">1天前</div>
                            </div>
                            <p>创建了新的基因组装仓库"植物转基因载体库"</p>
                        </div>
                        
                        <div class="warehouse-card fade-in">
                            <div class="warehouse-card-header">
                                <div class="warehouse-name">元件导入成功</div>
                                <div class="warehouse-id">3天前</div>
                            </div>
                            <p>从公共数据库导入了15个新元件到"细菌CRISPR工具库"</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 个人资料内容 -->
            <div class="content-section" style="display: none;" id="profile-content">
                <div class="content-header">
                    <div>
                        <h2>个人资料</h2>
                        <p class="content-subtitle">管理您的个人信息和账户设置</p>
                    </div>
                    <div>
                        <button class="sidebar-btn" style="background-color: #2a8bc5; color: white; width: auto;">
                            <i class="fas fa-edit"></i> 编辑资料
                        </button>
                    </div>
                </div>
                
                <div class="content-card fade-in">
                    <div class="card-header">
                        <div class="card-title">基本信息</div>
                    </div>
                    
                    <div class="profile-details">
                        <div class="detail-group">
                            <div class="detail-label">姓名</div>
                            <div class="detail-value">{{user.uname}}</div>
                        </div>
                        
                        <!-- <div class="detail-group">
                            <div class="detail-label">职称</div>
                            <div class="detail-value">博士 / 高级研究员</div>
                        </div> -->
                        
                        <div class="detail-group">
                            <div class="detail-label">邮箱</div>
                            <div class="detail-value">{{user.email}}</div>
                        </div>
                        
                        <!-- <div class="detail-group">
                            <div class="detail-label">所属机构</div>
                            <div class="detail-value">国家基因研究中心 - 分子生物学实验室</div>
                        </div> -->
                        
                        <!-- <div class="detail-group">
                            <div class="detail-label">研究方向</div>
                            <div class="detail-value">合成生物学、基因编辑、分子克隆</div>
                        </div> -->
                        
                        <div class="detail-group">
                            <div class="detail-label">注册时间</div>
                            <div class="detail-value">{{user.create_time}}</div>
                        </div>
                    </div>
                </div>
                
                <div class="content-card fade-in">
                    <div class="card-header">
                        <div class="card-title">账户安全</div>
                    </div>
                    
                    <div class="profile-details">
                        <div class="detail-group">
                            <div class="detail-label">最后登录</div>
                            <div class="detail-value">{{user.last_activate}}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">账户状态</div>
                            <div class="detail-value" style="color: #4caf50; background-color: #f0f9f0;">
                                {% if user.is_active %}
                                    活跃
                                {% else %}
                                    非活跃
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">双重验证</div>
                            <div class="detail-value" style="color: #f57c00; background-color: #fff8f0;">未启用</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 25px; display: flex; gap: 15px;">
                        <button class="sidebar-btn" style="background-color: #4caf50; color: white; width: auto;">
                            <i class="fas fa-key"></i> 更改密码
                        </button>
                        <button class="sidebar-btn" style="background-color: #f0f7ff; color: #2a8bc5; width: auto;">
                            <i class="fas fa-shield-alt"></i> 启用双重验证
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- 组装仓库内容 -->
            <div class="content-section" style="display: none;" id="warehouse-content">
                <div class="content-header">
                    <div>
                        <h2>我的组装仓库</h2>
                        <p class="content-subtitle">管理您的基因元件、载体骨架和质粒库</p>
                    </div>
                    <div>
                        <button class="sidebar-btn" style="background-color: #2a8bc5; color: white; width: auto;" id="create-warehouse-btn">
                            <i class="fas fa-plus"></i> 新建仓库
                        </button>
                    </div>
                </div>
                
                <div class="content-card fade-in">
                    <div class="card-header">
                        <div class="card-title">所有仓库</div>
                        <div style="display: flex; gap: 10px;">
                            <button class="sidebar-btn" style="background-color: #f0f7ff; color: #2a8bc5; width: auto; padding: 8px 15px;">
                                <i class="fas fa-filter"></i> 筛选
                            </button>
                            <button class="sidebar-btn" style="background-color: #f0f7ff; color: #2a8bc5; width: auto; padding: 8px 15px;">
                                <i class="fas fa-sort"></i> 排序
                            </button>
                        </div>
                    </div>
                    
                    <div id="warehouse-container">
                        <!-- 仓库列表将通过JavaScript动态生成 -->
                    </div>
                </div>
            </div>
            
            <!-- 其他内容区域占位符 -->
            <div class="content-section" style="display: none;" id="projects-content">
                <div class="content-header">
                    <div>
                        <h2>我的项目</h2>
                        <p class="content-subtitle">查看和管理您的基因组装项目</p>
                    </div>
                </div>
                <div class="empty-state">
                    <i class="fas fa-flask"></i>
                    <h3>项目功能开发中</h3>
                    <p>此功能正在开发中，即将推出</p>
                </div>
            </div>
            
            <div class="content-section" style="display: none;" id="templates-content">
                <div class="content-header">
                    <div>
                        <h2>组装模板</h2>
                        <p class="content-subtitle">使用预定义模板快速开始组装项目</p>
                    </div>
                </div>
                <div class="empty-state">
                    <i class="fas fa-clone"></i>
                    <h3>模板功能开发中</h3>
                    <p>此功能正在开发中，即将推出</p>
                </div>
            </div>
            
            <div class="content-section" style="display: none;" id="tools-content">
                <div class="content-header">
                    <div>
                        <h2>工具</h2>
                        <p class="content-subtitle">基因组装相关工具和计算器</p>
                    </div>
                </div>
                <div class="empty-state">
                    <i class="fas fa-tools"></i>
                    <h3>工具功能开发中</h3>
                    <p>此功能正在开发中，即将推出</p>
                </div>
            </div>
            
            <div class="content-section" style="display: none;" id="settings-content">
                <div class="content-header">
                    <div>
                        <h2>设置</h2>
                        <p class="content-subtitle">平台偏好设置和配置</p>
                    </div>
                </div>
                <div class="empty-state">
                    <i class="fas fa-cog"></i>
                    <h3>设置功能开发中</h3>
                    <p>此功能正在开发中，即将推出</p>
                </div>
            </div>
        </div>
    </div>

    <script>

        // 当前选中的内容
        let currentContent = "dashboard";
        let currentWarehouseId = null;

        // DOM元素
        const warehouseNav = document.getElementById('warehouse-nav');
        const warehouseList = document.getElementById('warehouse-list');
        const navItems = document.querySelectorAll('.nav-item');
        const contentSections = document.querySelectorAll('.content-section');
        const warehouseContainer = document.getElementById('warehouse-container');
        const warehouseCountEl = document.getElementById('warehouse-count');
        const projectCountEl = document.getElementById('project-count');
        const componentCountEl = document.getElementById('component-count');
        const plasmidCountEl = document.getElementById('plasmid-count');

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化仓库列表
            renderWarehouseList();
            
            setupMenuEvents();
            
            // // 更新统计信息
            // updateStats();
            
            // // 设置导航事件
            // setupNavigation();
            
            // 设置仓库导航展开/折叠
            // setupWarehouseNav();
            
            // 设置按钮事件
            setupButtons();

        });

        function setupMenuEvents(){
            const menuHeaders = document.querySelectorAll(".nav-item");
            menuHeaders.forEach(headers => {
                headers.addEventListener('click',function(e){
                    console.log("111111111111111111");
                    menuHeaders.forEach(i => i.classList.remove('active'));
                    headers.classList.add('active');
                    const tool = headers.getAttribute('data-content');
                    console.log(tool);
                    if(tool){
                        switchTool(tool);
                    }
                    e.stopPropagation();
                })
            });
        }

        function switchTool(tool){
            switch(tool){
                case "dashboard":
                    showdashbord();
                    break;
                case "profile":
                    showprofile();
                    break;
                case "warehouse":
                    showwarehouse();
                    break;
                case "projects":
                    showprojects();
                    break;
                case "templates":
                    showtemplates();
                    break;
                case "tools":
                    showtools();
                    break;
                case "settings":
                    showsettings();
                    break;
            }
        }

        function showdashbord(){
            document.getElementById("dashboard-content").style.display = "block";
            document.getElementById("profile-content").style.display = "none";
            document.getElementById("warehouse-content").style.display = "none";
            document.getElementById("projects-content").style.display = "none";
            document.getElementById("templates-content").style.display = "none";
            document.getElementById("tools-content").style.display = "none";
            document.getElementById("settings-content").style.display = "none";
        }

        function showprofile(){
            document.getElementById("dashboard-content").style.display = "none";
            document.getElementById("profile-content").style.display = "block";
            document.getElementById("warehouse-content").style.display = "none";
            document.getElementById("projects-content").style.display = "none";
            document.getElementById("templates-content").style.display = "none";
            document.getElementById("tools-content").style.display = "none";
            document.getElementById("settings-content").style.display = "none";
        }

        function showwarehouse(){
            document.getElementById("dashboard-content").style.display = "none";
            document.getElementById("profile-content").style.display = "none";
            document.getElementById("warehouse-content").style.display = "block";
            document.getElementById("projects-content").style.display = "none";
            document.getElementById("templates-content").style.display = "none";
            document.getElementById("tools-content").style.display = "none";
            document.getElementById("settings-content").style.display = "none";
        }

        function showprojects(){
            document.getElementById("dashboard-content").style.display = "none";
            document.getElementById("profile-content").style.display = "none";
            document.getElementById("warehouse-content").style.display = "none";
            document.getElementById("projects-content").style.display = "block";
            document.getElementById("templates-content").style.display = "none";
            document.getElementById("tools-content").style.display = "none";
            document.getElementById("settings-content").style.display = "none";
        }

        function showtemplates(){
            document.getElementById("dashboard-content").style.display = "none";
            document.getElementById("profile-content").style.display = "none";
            document.getElementById("warehouse-content").style.display = "none";
            document.getElementById("projects-content").style.display = "none";
            document.getElementById("templates-content").style.display = "block";
            document.getElementById("tools-content").style.display = "none";
            document.getElementById("settings-content").style.display = "none";
        }

        function showtools(){
            document.getElementById("dashboard-content").style.display = "none";
            document.getElementById("profile-content").style.display = "none";
            document.getElementById("warehouse-content").style.display = "none";
            document.getElementById("projects-content").style.display = "none";
            document.getElementById("templates-content").style.display = "none";
            document.getElementById("tools-content").style.display = "block";
            document.getElementById("settings-content").style.display = "none";
        }

        function showsettings(){
            document.getElementById("dashboard-content").style.display = "none";
            document.getElementById("profile-content").style.display = "none";
            document.getElementById("warehouse-content").style.display = "none";
            document.getElementById("projects-content").style.display = "none";
            document.getElementById("templates-content").style.display = "none";
            document.getElementById("tools-content").style.display = "none";
            document.getElementById("settings-content").style.display = "block";
        }

        // 渲染侧边栏仓库列表
        function renderWarehouseList() {
            fetch('/WebDatabase/getrepos')
            .then(response => response.json())
            .then(data =>{
                if(data.success){
                    warehouseList.innerHTML = '';
                    data.repo.forEach(warehouse => {
                        console.log("renderWarehouseList");
                        const warehouseItem = document.createElement('div');
                        warehouseItem.className = 'warehouse-subitem';
                        // warehouseItem.dataset.name = warehouse.name;
                        // warehouseItem.dataset.content = 'warehouse-detail';
                
                        warehouseItem.innerHTML = `
                            <i class="fas fa-warehouse"></i>
                            <span>${warehouse.name}</span>
                        `;
                        console.log(warehouseItem.innerHTML)
                        warehouseItem.addEventListener('click', function(e) {
                            e.stopPropagation();
                    
                            // 更新选中状态
                            updateNavSelection(this, 'warehouse-subitem');
                    
                            // 显示仓库详情
                            showWarehouseDetail(warehouse.name);
                    
                            // 切换到仓库内容
                            showwarehouse();
                    
                            // 滚动到仓库详情
                            currentWarehouseId = warehouse.id;
                        });
                        warehouseList.appendChild(warehouseItem);
                    })
                    warehouseContainer.innerHTML = '';

                    if (data.repo.length == 0){
                        warehouseContainer.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-warehouse"></i>
                                <h3>暂无组装仓库</h3>
                                <p>点击"新建仓库"按钮创建您的第一个基因组装仓库</p>
                            </div>
                        `;
                        return;
                    }
                    data.repo.forEach(warehouse => {
                        console.log(warehouse);
                        const warehouseCard = document.createElement('div');
                        warehouseCard.className = 'warehouse-card fade-in';
                        // warehouseCard.dataset.name = warehouse.name;
                
                        warehouseCard.innerHTML = `
                            <div class="warehouse-card-header">
                                <div class="warehouse-name">${warehouse.name}</div>
                                <div class="warehouse-id">${warehouse.id}</div>
                            </div>
                            <p style="color: #64748b; margin-bottom: 15px;">${warehouse.note}</p>
                            <div class="warehouse-stats">
                                <div class="warehouse-stat">
                                    <i class="fas fa-dna"></i>
                                    <span>${warehouse.data.parts.length} 个元件</span>
                                </div>
                                <div class="warehouse-stat">
                                    <i class="fas fa-vector-square"></i>
                                    <span>${warehouse.data.backbones.length} 个载体</span>
                                </div>
                                <div class="warehouse-stat">
                                    <i class="fas fa-circle-dna"></i>
                                    <span>${warehouse.data.plasmids.length} 个质粒</span>
                                </div>
                            </div>
                            <div class="warehouse-tags">
                            </div>
                        `;
                
                        warehouseCard.addEventListener('click', function() {
                            const warehouseName = this.querySelector('.warehouse-name').textContent;
                    
                            // 更新侧边栏选中状态
                            updateNavSelectionForWarehouse(warehouseName);
                    
                            // 显示仓库详情
                            showWarehouseDetail(warehouseName);
                    
                            // 确保仓库列表是展开的
                            if (!warehouseList.classList.contains('expanded')) {
                                warehouseList.classList.add('expanded');
                                warehouseNav.querySelector('.nav-arrow').classList.add('rotated');
                            }
                        });
                        warehouseContainer.appendChild(warehouseCard);
                    });


                    warehouseNav.addEventListener('click', function(e) {
                        e.stopPropagation();
                        console.log("aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa");
                        // 切换展开/折叠状态
                        warehouseList.classList.toggle('expanded');
                        this.querySelector('.nav-arrow').classList.toggle('rotated');
                
                        // 如果展开并且没有选中仓库子项，选中第一个
                        if (warehouseList.classList.contains('expanded')) {
                            // 切换到仓库内容
                            showwarehouse();
                    
                            // 更新导航选中状态
                            updateNavSelection(this, 'nav-item');
                    
                            // 如果没有选中的仓库子项，选中第一个
                            if (!currentWarehouseId) {
                                setTimeout(() => {
                                    const firstWarehouse = document.querySelector('.warehouse-subitem');
                                    if (firstWarehouse) {
                                        updateNavSelection(firstWarehouse, 'warehouse-subitem');
                                        console.log(data.repo[0].name);
                                        showWarehouseDetail(data.repo[0].name);
                                    }
                                }, 100);
                            }
                        }
                    });


                }
            });
        }


        // 显示仓库详情
        function showWarehouseDetail(warehouseName) {
            const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

            fetch("/WebDatabase/getrepo",{
                method: "POST",
                headers:{
                        'Content-Type':'application/json',
                        'X-CSRFToken': csrfToken,
                    },
                    body: JSON.stringify({"Name":warehouseName}),
            }).then(response => response.json())
            .then(data =>{
                if(data.success){
                    document.querySelector('#warehouse-content .content-header h2').textContent = warehouseName;
                    document.querySelector('#warehouse-content .content-subtitle').textContent = data.repository;
                }
                else{
                    return;
                }
            })
        }


        // // 设置导航事件
        // function setupNavigation() {
        //     navItems.forEach(item => {
        //         // 排除仓库导航（它有特殊的展开/折叠功能）
        //         if (item.id !== 'warehouse-nav') {
        //             item.addEventListener('click', function() {
        //                 const content = this.dataset.content;
                        
        //                 // 更新导航选中状态
        //                 updateNavSelection(this, 'nav-item');
                        
        //                 // 切换到对应内容
        //                 switchContent(content);
                        
        //                 // 如果点击的是其他导航项，折叠仓库列表
        //                 if (content !== 'warehouse') {
        //                     warehouseList.classList.remove('expanded');
        //                     warehouseNav.querySelector('.nav-arrow').classList.remove('rotated');
        //                 }
        //             });
        //         }
        //     });
            
        //     // 点击用户资料头
        //     document.getElementById('profile-header').addEventListener('click', function() {
        //         updateNavSelection(document.querySelector('.nav-item[data-content="profile"]'), 'nav-item');
        //         switchContent('profile');
        //     });
        // }

        // // 设置仓库导航展开/折叠
        // function setupWarehouseNav() {
        //     warehouseNav.addEventListener('click', function(e) {
        //         e.stopPropagation();
        //         console.log("aaa");
                
        //         // 切换展开/折叠状态
        //         warehouseList.classList.toggle('expanded');
        //         console.log("pppppppp");
        //         this.querySelector('.nav-arrow').classList.toggle('rotated');
                
        //         // 如果展开并且没有选中仓库子项，选中第一个
        //         if (warehouseList.classList.contains('expanded')) {
        //             // 切换到仓库内容
        //             showwarehouse();
                    
        //             // 更新导航选中状态
        //             updateNavSelection(this, 'nav-item');
                    
        //             // // 如果没有选中的仓库子项，选中第一个
        //             // if (!currentWarehouseId) {
        //             //     setTimeout(() => {
        //             //         const firstWarehouse = document.querySelector('.warehouse-subitem');
        //             //         if (firstWarehouse) {
        //             //             updateNavSelection(firstWarehouse, 'warehouse-subitem');
        //             //             showWarehouseDetail(warehouses[0].id);
        //             //         }
        //             //     }, 100);
        //             // }
        //         }
        //     });
        // }

        // 更新导航选中状态
        function updateNavSelection(selectedElement, className) {
            // 移除所有同类的active类
            document.querySelectorAll(`.${className}`).forEach(item => {
                item.classList.remove('active');
            });
            
            // 为选中元素添加active类
            selectedElement.classList.add('active');
            
            // 如果是仓库子项，也高亮父级
            if (className === 'warehouse-subitem') {
                warehouseNav.classList.add('active');
            }
        }

        // 为仓库更新侧边栏选中状态
        function updateNavSelectionForWarehouse(warehouseId) {
            // 移除所有仓库子项的active类
            document.querySelectorAll('.warehouse-subitem').forEach(item => {
                item.classList.remove('active');
            });
            
            // 为对应仓库添加active类
            const warehouseItem = document.querySelector(`.warehouse-subitem[data-id="${warehouseId}"]`);
            if (warehouseItem) {
                warehouseItem.classList.add('active');
                warehouseNav.classList.add('active');
            }
        }

        // 切换内容区域
        function switchContent(content) {
            // 隐藏所有内容区域
            contentSections.forEach(section => {
                section.classList.remove('active');
            });
            
            // 显示选中的内容区域
            const targetSection = document.getElementById(`${content}-content`);
            if (targetSection) {
                targetSection.classList.add('active');
                currentContent = content;
            }
        }

        // 设置按钮事件
        function setupButtons() {
            // 新建仓库按钮
            document.getElementById('create-warehouse-btn').addEventListener('click', function() {
                
                
                // 重新渲染仓库列表
                renderWarehouseList();
                renderWarehouseContent();
                
                // // 更新统计信息
                // updateStats();
                
                // 展开仓库列表
                warehouseList.classList.add('expanded');
                warehouseNav.querySelector('.nav-arrow').classList.add('rotated');
                
                // 切换到仓库内容
                switchContent('warehouse');
                
                // 选中新仓库
                setTimeout(() => {
                    const newWarehouseItem = document.querySelector(`.warehouse-subitem`);
                    if (newWarehouseItem) {
                        updateNavSelection(newWarehouseItem, 'warehouse-subitem');
                        showWarehouseDetail(warehouse.name);
                    }
                }, 100);
                
                alert(`新仓库已创建！`);
            });
            
            // 退出登录按钮
            document.getElementById('logout-btn').addEventListener('click', function() {
                if (confirm('确定要退出登录吗？')) {
                    alert('已退出登录，正在跳转到登录页面...');
                    // 在实际应用中，这里会跳转到登录页面
                    // window.location.href = '/login';
                }
            });
        }
    </script>
</body>
</html>