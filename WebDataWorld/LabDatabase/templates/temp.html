<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EChartsæ ‘çŠ¶å›¾èŠ‚ç‚¹ç‚¹å‡»äº‹ä»¶</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
        }
        
        h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #3498db, #9b59b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 1100px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .sidebar {
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            height: fit-content;
        }
        
        .control-group {
            margin-bottom: 30px;
        }
        
        .control-group h3 {
            color: #3498db;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .control-group h3 i {
            font-size: 20px;
        }
        
        .chart-container {
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            height: 700px;
        }
        
        #treeChart {
            width: 100%;
            height: 650px;
        }
        
        .event-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        button {
            padding: 12px 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        #resetBtn {
            background-color: #e74c3c;
        }
        
        #resetBtn:hover {
            background-color: #c0392b;
        }
        
        #highlightPathBtn {
            background-color: #2ecc71;
        }
        
        #highlightPathBtn:hover {
            background-color: #27ae60;
        }
        
        .event-info {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .event-info h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .event-log {
            background-color: #2c3e50;
            color: #ecf0f1;
            border-radius: 8px;
            padding: 15px;
            font-family: monospace;
            font-size: 13px;
            max-height: 150px;
            overflow-y: auto;
            margin-top: 10px;
        }
        
        .event-log .log-item {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .event-log .log-item:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }
        
        .node-details {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 2px solid #3498db;
        }
        
        .node-details h4 {
            color: #3498db;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .detail-item:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }
        
        .detail-label {
            font-weight: 600;
            color: #7f8c8d;
        }
        
        .detail-value {
            font-weight: 500;
            color: #2c3e50;
            text-align: right;
            max-width: 150px;
            word-break: break-word;
        }
        
        .event-types {
            margin-top: 25px;
        }
        
        .event-types h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .event-type-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .event-type-tag {
            padding: 8px 12px;
            background-color: #e8f4fc;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            color: #3498db;
            border: 1px solid #3498db;
        }
        
        .instructions {
            background-color: white;
            border-radius: 15px;
            padding: 30px;
            margin-top: 40px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
        }
        
        .instructions h2 {
            color: #2c3e50;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .code-example {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 14px;
            line-height: 1.5;
            margin: 20px 0;
            overflow-x: auto;
        }
        
        .code-comment {
            color: #95a5a6;
        }
        
        .code-keyword {
            color: #3498db;
        }
        
        .code-string {
            color: #2ecc71;
        }
        
        .code-function {
            color: #f39c12;
        }
        
        .example-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }
        
        .example-card {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #3498db;
        }
        
        .example-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .example-card p {
            color: #7f8c8d;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .selected-node {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(46, 204, 113, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(46, 204, 113, 0);
            }
        }
        
        .node-highlighted {
            filter: drop-shadow(0 0 8px rgba(52, 152, 219, 0.8));
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .event-buttons {
                grid-template-columns: 1fr;
            }
            
            header {
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>EChartsæ ‘çŠ¶å›¾èŠ‚ç‚¹ç‚¹å‡»äº‹ä»¶</h1>
            <p class="subtitle">å±•ç¤ºå¦‚ä½•ä¸ºEChartsæ ‘çŠ¶å›¾çš„æ¯ä¸ªèŠ‚ç‚¹è®¾ç½®ç‚¹å‡»äº‹ä»¶ï¼Œå®ç°ä¸°å¯Œçš„äº¤äº’åŠŸèƒ½</p>
        </header>
        
        <div class="main-content">
            <div class="sidebar">
                <div class="control-group">
                    <h3><i>ğŸ–±ï¸</i> äº‹ä»¶æ§åˆ¶</h3>
                    <div class="event-buttons">
                        <button id="clearLogBtn">
                            <i>ğŸ—‘ï¸</i> æ¸…ç©ºäº‹ä»¶æ—¥å¿—
                        </button>
                        <button id="resetBtn">
                            <i>ğŸ”„</i> é‡ç½®é€‰ä¸­çŠ¶æ€
                        </button>
                        <button id="expandAllBtn">
                            <i>ğŸ“ˆ</i> å±•å¼€å…¨éƒ¨èŠ‚ç‚¹
                        </button>
                        <button id="collapseAllBtn">
                            <i>ğŸ“‰</i> æŠ˜å å…¨éƒ¨èŠ‚ç‚¹
                        </button>
                    </div>
                    
                    <div class="event-info">
                        <h4><i>ğŸ“</i> äº‹ä»¶æ—¥å¿—</h4>
                        <div class="event-log" id="eventLog">
                            <div class="log-item">äº‹ä»¶æ—¥å¿—åŒºåŸŸï¼Œç‚¹å‡»èŠ‚ç‚¹æŸ¥çœ‹äº‹ä»¶ä¿¡æ¯</div>
                        </div>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3><i>ğŸ“‹</i> èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯</h3>
                    <div class="node-details">
                        <h4><i>ğŸ”</i> å½“å‰é€‰ä¸­èŠ‚ç‚¹</h4>
                        <div id="nodeDetails">
                            <div class="detail-item">
                                <span class="detail-label">èŠ‚ç‚¹åç§°:</span>
                                <span class="detail-value">è¯·ç‚¹å‡»æ ‘çŠ¶å›¾ä¸­çš„èŠ‚ç‚¹</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">èŠ‚ç‚¹å€¼:</span>
                                <span class="detail-value">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">èŠ‚ç‚¹æ·±åº¦:</span>
                                <span class="detail-value">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">å­èŠ‚ç‚¹æ•°:</span>
                                <span class="detail-value">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">èŠ‚ç‚¹ç±»å‹:</span>
                                <span class="detail-value">-</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3><i>âš¡</i> é«˜çº§æ“ä½œ</h3>
                    <div class="event-buttons">
                        <button id="highlightPathBtn">
                            <i>âœ¨</i> é«˜äº®è·¯å¾„åˆ°æ ¹èŠ‚ç‚¹
                        </button>
                        <button id="selectChildrenBtn">
                            <i>ğŸ‘¨â€ğŸ‘§â€ğŸ‘¦</i> é€‰ä¸­æ‰€æœ‰å­èŠ‚ç‚¹
                        </button>
                        <button id="addChildBtn">
                            <i>â•</i> æ·»åŠ å­èŠ‚ç‚¹
                        </button>
                        <button id="removeNodeBtn">
                            <i>â–</i> åˆ é™¤èŠ‚ç‚¹
                        </button>
                    </div>
                </div>
                
                <div class="event-types">
                    <h4><i>ğŸ“Š</i> æ”¯æŒçš„äº‹ä»¶ç±»å‹</h4>
                    <div class="event-type-list">
                        <div class="event-type-tag">click</div>
                        <div class="event-type-tag">dblclick</div>
                        <div class="event-type-tag">mouseover</div>
                        <div class="event-type-tag">mouseout</div>
                        <div class="event-type-tag">contextmenu</div>
                    </div>
                </div>
            </div>
            
            <div class="chart-container">
                <div id="treeChart"></div>
            </div>
        </div>
        
        <div class="instructions">
            <h2>EChartsèŠ‚ç‚¹ç‚¹å‡»äº‹ä»¶å®ç°æŒ‡å—</h2>
            
            <div class="code-example">
<span class="code-comment">// 1. åˆå§‹åŒ–EChartså®ä¾‹</span>
<span class="code-keyword">const</span> chart = echarts.init(<span class="code-string">document</span>.getElementById(<span class="code-string">'treeChart'</span>));

<span class="code-comment">// 2. è®¾ç½®å›¾è¡¨é…ç½®é¡¹</span>
<span class="code-keyword">const</span> option = {
    <span class="code-string">series</span>: [{
        <span class="code-string">type</span>: <span class="code-string">'tree'</span>,
        <span class="code-string">data</span>: [treeData],
        <span class="code-comment">// ... å…¶ä»–é…ç½®</span>
    }]
};

<span class="code-comment">// 3. ä¸ºå›¾è¡¨è®¾ç½®ç‚¹å‡»äº‹ä»¶ç›‘å¬</span>
chart.on(<span class="code-string">'click'</span>, <span class="code-keyword">function</span> (params) {
    <span class="code-comment">// params åŒ…å«ç‚¹å‡»çš„èŠ‚ç‚¹ä¿¡æ¯</span>
    <span class="code-keyword">if</span> (params.componentType === <span class="code-string">'series'</span> && params.seriesType === <span class="code-string">'tree'</span>) {
        <span class="code-keyword">const</span> nodeData = params.data;
        <span class="code-string">console</span>.log(<span class="code-string">'ç‚¹å‡»çš„èŠ‚ç‚¹:'</span>, nodeData.name);
        <span class="code-comment">// æ‰§è¡Œè‡ªå®šä¹‰æ“ä½œ</span>
    }
});

<span class="code-comment">// 4. æ¸²æŸ“å›¾è¡¨</span>
chart.setOption(option);
            </div>
            
            <div class="example-grid">
                <div class="example-card">
                    <h3><i>ğŸ¯</i> åŸºæœ¬ç‚¹å‡»äº‹ä»¶</h3>
                    <p>é€šè¿‡ <code>chart.on('click', callback)</code> ç›‘å¬èŠ‚ç‚¹ç‚¹å‡»äº‹ä»¶ï¼Œè·å–èŠ‚ç‚¹ä¿¡æ¯å¹¶åœ¨æ§åˆ¶å°è¾“å‡ºã€‚</p>
                </div>
                
                <div class="example-card">
                    <h3><i>ğŸ”</i> èŠ‚ç‚¹ä¿¡æ¯è·å–</h3>
                    <p>äº‹ä»¶å‚æ•° <code>params</code> åŒ…å«å®Œæ•´çš„èŠ‚ç‚¹ä¿¡æ¯ï¼šåç§°ã€å€¼ã€æ·±åº¦ã€å­èŠ‚ç‚¹åˆ—è¡¨ç­‰ã€‚</p>
                </div>
                
                <div class="example-card">
                    <h3><i>ğŸ¨</i> è§†è§‰åé¦ˆ</h3>
                    <p>ç‚¹å‡»èŠ‚ç‚¹åå¯ä»¥åŠ¨æ€ä¿®æ”¹èŠ‚ç‚¹æ ·å¼ï¼Œå¦‚æ”¹å˜é¢œè‰²ã€æ·»åŠ åŠ¨ç”»ã€æ˜¾ç¤ºé«˜äº®æ•ˆæœç­‰ã€‚</p>
                </div>
                
                <div class="example-card">
                    <h3><i>ğŸ”„</i> åŠ¨æ€æ“ä½œ</h3>
                    <p>åŸºäºç‚¹å‡»äº‹ä»¶å¯ä»¥å®ç°æ·»åŠ èŠ‚ç‚¹ã€åˆ é™¤èŠ‚ç‚¹ã€å±•å¼€/æŠ˜å ã€é«˜äº®è·¯å¾„ç­‰åŠ¨æ€æ“ä½œã€‚</p>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>EChartsæ ‘çŠ¶å›¾èŠ‚ç‚¹ç‚¹å‡»äº‹ä»¶å®ç° | æ”¯æŒå¤šç§äº¤äº’æ“ä½œå’Œè§†è§‰åé¦ˆæ•ˆæœ</p>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let chart;
        let selectedNode = null;
        let originalNodeStyle = new Map(); // ä¿å­˜åŸå§‹èŠ‚ç‚¹æ ·å¼
        let eventLog = [];
        
        // ç¤ºä¾‹æ ‘çŠ¶å›¾æ•°æ®
        const treeData = {
            name: "ä¸­å›½",
            value: 100,
            depth: 0,
            children: [
                {
                    name: "åä¸œåœ°åŒº",
                    value: 40,
                    depth: 1,
                    children: [
                        {
                            name: "æµ™æ±Ÿçœ",
                            value: 20,
                            depth: 2,
                            children: [
                                { name: "æ­å·å¸‚", value: 10, depth: 3 },
                                { name: "å®æ³¢å¸‚", value: 6, depth: 3 },
                                { name: "æ¸©å·å¸‚", value: 4, depth: 3 }
                            ]
                        },
                        {
                            name: "æ±Ÿè‹çœ",
                            value: 15,
                            depth: 2,
                            children: [
                                { name: "å—äº¬å¸‚", value: 8, depth: 3 },
                                { name: "è‹å·å¸‚", value: 7, depth: 3 }
                            ]
                        },
                        {
                            name: "ä¸Šæµ·å¸‚",
                            value: 5,
                            depth: 2,
                            children: [
                                { name: "æµ¦ä¸œæ–°åŒº", value: 3, depth: 3 },
                                { name: "å¾æ±‡åŒº", value: 2, depth: 3 }
                            ]
                        }
                    ]
                },
                {
                    name: "åå—åœ°åŒº",
                    value: 35,
                    depth: 1,
                    children: [
                        {
                            name: "å¹¿ä¸œçœ",
                            value: 20,
                            depth: 2,
                            children: [
                                { name: "å¹¿å·å¸‚", value: 10, depth: 3 },
                                { name: "æ·±åœ³å¸‚", value: 8, depth: 3 },
                                { name: "ä¸œèå¸‚", value: 2, depth: 3 }
                            ]
                        },
                        {
                            name: "å¹¿è¥¿çœ",
                            value: 15,
                            depth: 2,
                            children: [
                                { name: "å—å®å¸‚", value: 8, depth: 3 },
                                { name: "æ¡‚æ—å¸‚", value: 5, depth: 3 },
                                { name: "æŸ³å·å¸‚", value: 2, depth: 3 }
                            ]
                        }
                    ]
                },
                {
                    name: "ååŒ—åœ°åŒº",
                    value: 25,
                    depth: 1,
                    children: [
                        {
                            name: "åŒ—äº¬å¸‚",
                            value: 15,
                            depth: 2,
                            children: [
                                { name: "æœé˜³åŒº", value: 6, depth: 3 },
                                { name: "æµ·æ·€åŒº", value: 5, depth: 3 },
                                { name: "ä¸œåŸåŒº", value: 4, depth: 3 }
                            ]
                        },
                        {
                            name: "å¤©æ´¥å¸‚",
                            value: 10,
                            depth: 2,
                            children: [
                                { name: "å’Œå¹³åŒº", value: 4, depth: 3 },
                                { name: "æ²³è¥¿åŒº", value: 3, depth: 3 },
                                { name: "å—å¼€åŒº", value: 3, depth: 3 }
                            ]
                        }
                    ]
                }
            ]
        };
        
        // åˆå§‹åŒ–å›¾è¡¨
        function initChart() {
            const chartDom = document.getElementById('treeChart');
            chart = echarts.init(chartDom);
            
            // è®¾ç½®å›¾è¡¨é…ç½®
            const option = getChartOption();
            chart.setOption(option);
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬
            setupEventListeners();
            
            // çª—å£å¤§å°å˜åŒ–æ—¶é‡ç»˜
            window.addEventListener('resize', function() {
                chart.resize();
            });
        }
        
        // è·å–å›¾è¡¨é…ç½®
        function getChartOption() {
            return {
                title: {
                    text: 'ä¸­å›½åœ°åŒºå±‚çº§ç»“æ„',
                    left: 'center',
                    textStyle: {
                        color: '#2c3e50',
                        fontSize: 22,
                        fontWeight: 'bold'
                    },
                    subtext: 'ç‚¹å‡»èŠ‚ç‚¹æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯',
                    subtextStyle: {
                        color: '#7f8c8d',
                        fontSize: 14
                    }
                },
                tooltip: {
                    trigger: 'item',
                    triggerOn: 'mousemove',
                    formatter: function(params) {
                        const node = params.data;
                        const childrenCount = node.children ? node.children.length : 0;
                        return `
                        <div style="padding: 10px; min-width: 180px;">
                            <div style="font-weight: bold; margin-bottom: 5px; color: #3498db;">${node.name}</div>
                            <div style="margin-bottom: 3px;">å€¼: <span style="color: #2ecc71;">${node.value || 0}</span></div>
                            <div style="margin-bottom: 3px;">æ·±åº¦: <span style="color: #f39c12;">${node.depth}</span></div>
                            <div style="margin-bottom: 3px;">å­èŠ‚ç‚¹æ•°: <span style="color: #9b59b6;">${childrenCount}</span></div>
                            <div style="margin-top: 8px; font-size: 12px; color: #95a5a6;">ç‚¹å‡»æŸ¥çœ‹æ›´å¤šæ“ä½œ</div>
                        </div>`;
                    }
                },
                series: [{
                    type: 'tree',
                    data: [treeData],
                    top: '60px',
                    left: '20px',
                    bottom: '20px',
                    right: '20px',
                    symbolSize: 15,
                    label: {
                        position: 'left',
                        verticalAlign: 'middle',
                        align: 'right',
                        fontSize: 14,
                        fontWeight: 'bold',
                        color: '#2c3e50'
                    },
                    leaves: {
                        label: {
                            position: 'right',
                            verticalAlign: 'middle',
                            align: 'left'
                        }
                    },
                    emphasis: {
                        focus: 'descendant',
                        itemStyle: {
                            color: '#2ecc71'
                        }
                    },
                    expandAndCollapse: true,
                    initialTreeDepth: 2,
                    lineStyle: {
                        color: '#95a5a6',
                        width: 2,
                        curveness: 0.2
                    },
                    itemStyle: {
                        color: function(params) {
                            // æ ¹æ®èŠ‚ç‚¹æ·±åº¦è®¾ç½®é¢œè‰²
                            const depth = params.data.depth;
                            const colors = ['#e74c3c', '#3498db', '#2ecc71', '#f39c12', '#9b59b6'];
                            return colors[depth % colors.length];
                        },
                        borderColor: '#fff',
                        borderWidth: 2,
                        shadowBlur: 5,
                        shadowColor: 'rgba(0, 0, 0, 0.1)'
                    },
                    roam: true
                }]
            };
        }
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬
        function setupEventListeners() {
            // 1. ç‚¹å‡»äº‹ä»¶ - æœ€åŸºæœ¬çš„èŠ‚ç‚¹ç‚¹å‡»
            chart.on('click', function(params) {
                if (params.componentType === 'series' && params.seriesType === 'tree') {
                    handleNodeClick(params.data, params.event);
                }
            });
            
            // 2. åŒå‡»äº‹ä»¶
            chart.on('dblclick', function(params) {
                if (params.componentType === 'series' && params.seriesType === 'tree') {
                    handleNodeDoubleClick(params.data, params.event);
                }
            });
            
            // 3. é¼ æ ‡ç§»å…¥äº‹ä»¶
            chart.on('mouseover', function(params) {
                if (params.componentType === 'series' && params.seriesType === 'tree') {
                    handleNodeMouseOver(params.data, params.event);
                }
            });
            
            // 4. é¼ æ ‡ç§»å‡ºäº‹ä»¶
            chart.on('mouseout', function(params) {
                if (params.componentType === 'series' && params.seriesType === 'tree') {
                    handleNodeMouseOut(params.data, params.event);
                }
            });
            
            // 5. å³é”®ç‚¹å‡»äº‹ä»¶
            chart.on('contextmenu', function(params) {
                if (params.componentType === 'series' && params.seriesType === 'tree') {
                    handleNodeRightClick(params.data, params.event);
                    // é˜»æ­¢é»˜è®¤å³é”®èœå•
                    params.event.event.preventDefault();
                    return false;
                }
            });
        }
        
        // å¤„ç†èŠ‚ç‚¹ç‚¹å‡»äº‹ä»¶
        function handleNodeClick(nodeData, event) {
            // è®°å½•äº‹ä»¶æ—¥å¿—
            addEventLog('click', `ç‚¹å‡»äº†èŠ‚ç‚¹: ${nodeData.name}`, nodeData);
            
            // æ›´æ–°é€‰ä¸­èŠ‚ç‚¹
            selectNode(nodeData);
            
            // æ›´æ–°èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯æ˜¾ç¤º
            updateNodeDetails(nodeData);
            
            // è§†è§‰åé¦ˆï¼šé«˜äº®é€‰ä¸­èŠ‚ç‚¹
            highlightSelectedNode(nodeData);
        }
        
        // å¤„ç†èŠ‚ç‚¹åŒå‡»äº‹ä»¶
        function handleNodeDoubleClick(nodeData, event) {
            addEventLog('dblclick', `åŒå‡»äº†èŠ‚ç‚¹: ${nodeData.name}`, nodeData);
            
            // åˆ‡æ¢èŠ‚ç‚¹çš„å±•å¼€/æŠ˜å çŠ¶æ€
            toggleNodeExpandState(nodeData);
        }
        
        // å¤„ç†é¼ æ ‡ç§»å…¥äº‹ä»¶
        function handleNodeMouseOver(nodeData, event) {
            addEventLog('mouseover', `é¼ æ ‡ç§»å…¥èŠ‚ç‚¹: ${nodeData.name}`, nodeData);
            
            // ä¸´æ—¶é«˜äº®èŠ‚ç‚¹
            temporaryHighlightNode(nodeData, true);
        }
        
        // å¤„ç†é¼ æ ‡ç§»å‡ºäº‹ä»¶
        function handleNodeMouseOut(nodeData, event) {
            addEventLog('mouseout', `é¼ æ ‡ç§»å‡ºèŠ‚ç‚¹: ${nodeData.name}`, nodeData);
            
            // å–æ¶ˆä¸´æ—¶é«˜äº®
            temporaryHighlightNode(nodeData, false);
        }
        
        // å¤„ç†å³é”®ç‚¹å‡»äº‹ä»¶
        function handleNodeRightClick(nodeData, event) {
            addEventLog('contextmenu', `å³é”®ç‚¹å‡»äº†èŠ‚ç‚¹: ${nodeData.name}`, nodeData);
            
            // æ˜¾ç¤ºè‡ªå®šä¹‰å³é”®èœå•ï¼ˆè¿™é‡Œç”¨alertä»£æ›¿ï¼‰
            alert(`å³é”®èœå• - ${nodeData.name}\n\nå¯æ‰§è¡Œæ“ä½œ:\n1. æ·»åŠ å­èŠ‚ç‚¹\n2. åˆ é™¤èŠ‚ç‚¹\n3. é‡å‘½åèŠ‚ç‚¹\n4. å¤åˆ¶èŠ‚ç‚¹`);
            
            // ä¹Ÿå¯ä»¥åœ¨æ­¤å¤„æ˜¾ç¤ºä¸€ä¸ªè‡ªå®šä¹‰çš„å³é”®èœå•
            // showCustomContextMenu(nodeData, event);
        }
        
        // é€‰æ‹©èŠ‚ç‚¹
        function selectNode(nodeData) {
            selectedNode = nodeData;
            
            // æ›´æ–°ç•Œé¢æ˜¾ç¤º
            document.querySelector('.node-details h4').innerHTML = `<i>ğŸ”</i> å½“å‰é€‰ä¸­èŠ‚ç‚¹: ${nodeData.name}`;
        }
        
        // é«˜äº®é€‰ä¸­èŠ‚ç‚¹
        function highlightSelectedNode(nodeData) {
            // é¦–å…ˆæ¸…é™¤ä¹‹å‰çš„é«˜äº®
            clearNodeHighlights();
            
            // ä¿å­˜å½“å‰é€‰ä¸­èŠ‚ç‚¹çš„åŸå§‹æ ·å¼
            saveOriginalNodeStyle(nodeData);
            
            // åº”ç”¨é«˜äº®æ ·å¼
            applyHighlightStyle(nodeData);
            
            // å¯é€‰ï¼šé«˜äº®ä»æ ¹èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹çš„è·¯å¾„
            highlightNodePath(nodeData);
        }
        
        // ä¿å­˜èŠ‚ç‚¹çš„åŸå§‹æ ·å¼
        function saveOriginalNodeStyle(nodeData) {
            // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œéœ€è¦è·å–å¹¶ä¿å­˜èŠ‚ç‚¹çš„åŸå§‹æ ·å¼
            // è¿™é‡Œç®€åŒ–ä¸ºå­˜å‚¨èŠ‚ç‚¹ID
            if (!originalNodeStyle.has(nodeData.name)) {
                originalNodeStyle.set(nodeData.name, {
                    color: nodeData.itemStyle ? nodeData.itemStyle.color : null,
                    borderColor: nodeData.itemStyle ? nodeData.itemStyle.borderColor : null
                });
            }
        }
        
        // åº”ç”¨é«˜äº®æ ·å¼
        function applyHighlightStyle(nodeData) {
            // æ›´æ–°å›¾è¡¨æ•°æ®ä¸­çš„èŠ‚ç‚¹æ ·å¼
            const option = chart.getOption();
            const series = option.series[0];
            
            // é€’å½’æŸ¥æ‰¾å¹¶æ›´æ–°èŠ‚ç‚¹æ ·å¼
            updateNodeStyleInData(series.data[0], nodeData.name, {
                itemStyle: {
                    color: '#e74c3c',
                    borderColor: '#c0392b',
                    borderWidth: 4,
                    shadowBlur: 10,
                    shadowColor: 'rgba(231, 76, 60, 0.8)'
                }
            });
            
            chart.setOption(option);
        }
        
        // é€’å½’æ›´æ–°èŠ‚ç‚¹æ ·å¼
        function updateNodeStyleInData(node, targetName, newStyle) {
            if (node.name === targetName) {
                node.itemStyle = newStyle.itemStyle;
                return true;
            }
            
            if (node.children) {
                for (let child of node.children) {
                    if (updateNodeStyleInData(child, targetName, newStyle)) {
                        return true;
                    }
                }
            }
            
            return false;
        }
        
        // é«˜äº®èŠ‚ç‚¹è·¯å¾„ï¼ˆä»æ ¹èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹ï¼‰
        function highlightNodePath(nodeData) {
            // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œéœ€è¦æ‰¾åˆ°ä»æ ¹èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹çš„è·¯å¾„
            // ç„¶åé«˜äº®è·¯å¾„ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹
            console.log('é«˜äº®è·¯å¾„åˆ°èŠ‚ç‚¹:', nodeData.name);
            
            // è¿™é‡Œå¯ä»¥æ·»åŠ å…·ä½“çš„è·¯å¾„é«˜äº®é€»è¾‘
            // ä¾‹å¦‚ï¼šæ‰¾åˆ°æ‰€æœ‰ç¥–å…ˆèŠ‚ç‚¹å¹¶é«˜äº®
        }
        
        // æ¸…é™¤èŠ‚ç‚¹é«˜äº®
        function clearNodeHighlights() {
            // æ¢å¤æ‰€æœ‰èŠ‚ç‚¹çš„åŸå§‹æ ·å¼
            const option = chart.getOption();
            const series = option.series[0];
            
            // é€’å½’æ¢å¤èŠ‚ç‚¹æ ·å¼
            restoreOriginalStyles(series.data[0]);
            
            chart.setOption(option);
        }
        
        // é€’å½’æ¢å¤åŸå§‹æ ·å¼
        function restoreOriginalStyles(node) {
            if (originalNodeStyle.has(node.name)) {
                const originalStyle = originalNodeStyle.get(node.name);
                node.itemStyle = originalStyle;
            }
            
            if (node.children) {
                for (let child of node.children) {
                    restoreOriginalStyles(child);
                }
            }
        }
        
        // ä¸´æ—¶é«˜äº®èŠ‚ç‚¹ï¼ˆé¼ æ ‡æ‚¬åœï¼‰
        function temporaryHighlightNode(nodeData, isHighlight) {
            const option = chart.getOption();
            const series = option.series[0];
            
            updateNodeStyleInData(series.data[0], nodeData.name, {
                itemStyle: {
                    color: isHighlight ? '#f39c12' : null,
                    borderColor: isHighlight ? '#d35400' : null,
                    borderWidth: isHighlight ? 3 : 2
                }
            });
            
            chart.setOption(option);
        }
        
        // åˆ‡æ¢èŠ‚ç‚¹å±•å¼€çŠ¶æ€
        function toggleNodeExpandState(nodeData) {
            // åœ¨å®é™…çš„EChartsä¸­ï¼ŒèŠ‚ç‚¹çš„å±•å¼€çŠ¶æ€æ˜¯è‡ªåŠ¨ç®¡ç†çš„
            // è¿™é‡Œæˆ‘ä»¬é€šè¿‡é‡æ–°è®¾ç½®initialTreeDepthæ¥æ¨¡æ‹Ÿåˆ‡æ¢
            const option = chart.getOption();
            
            // æŸ¥æ‰¾å½“å‰èŠ‚ç‚¹çš„å±•å¼€çŠ¶æ€
            // æ³¨æ„ï¼šEChartsçš„treeç³»åˆ—ä¼šè‡ªåŠ¨å¤„ç†å±•å¼€/æŠ˜å 
            
            // è¿™é‡Œå¯ä»¥æ·»åŠ è‡ªå®šä¹‰çš„å±•å¼€/æŠ˜å é€»è¾‘
            addEventLog('expand/collapse', `åˆ‡æ¢äº†èŠ‚ç‚¹ ${nodeData.name} çš„å±•å¼€çŠ¶æ€`, nodeData);
        }
        
        // æ›´æ–°èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯æ˜¾ç¤º
        function updateNodeDetails(nodeData) {
            const detailsContainer = document.getElementById('nodeDetails');
            const childrenCount = nodeData.children ? nodeData.children.length : 0;
            const nodeType = childrenCount > 0 ? 'çˆ¶èŠ‚ç‚¹' : 'å¶å­èŠ‚ç‚¹';
            
            detailsContainer.innerHTML = `
                <div class="detail-item">
                    <span class="detail-label">èŠ‚ç‚¹åç§°:</span>
                    <span class="detail-value">${nodeData.name}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">èŠ‚ç‚¹å€¼:</span>
                    <span class="detail-value">${nodeData.value || 0}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">èŠ‚ç‚¹æ·±åº¦:</span>
                    <span class="detail-value">${nodeData.depth || 0}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">å­èŠ‚ç‚¹æ•°:</span>
                    <span class="detail-value">${childrenCount}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">èŠ‚ç‚¹ç±»å‹:</span>
                    <span class="detail-value">${nodeType}</span>
                </div>
            `;
        }
        
        // æ·»åŠ äº‹ä»¶æ—¥å¿—
        function addEventLog(eventType, message, nodeData) {
            const timestamp = new Date().toLocaleTimeString();
            const logItem = {
                time: timestamp,
                type: eventType,
                message: message,
                node: nodeData.name
            };
            
            eventLog.unshift(logItem);
            
            // ä¿æŒæ—¥å¿—æœ€å¤š10æ¡
            if (eventLog.length > 10) {
                eventLog.pop();
            }
            
            // æ›´æ–°æ—¥å¿—æ˜¾ç¤º
            updateEventLogDisplay();
        }
        
        // æ›´æ–°äº‹ä»¶æ—¥å¿—æ˜¾ç¤º
        function updateEventLogDisplay() {
            const logContainer = document.getElementById('eventLog');
            logContainer.innerHTML = '';
            
            eventLog.forEach(log => {
                const logElement = document.createElement('div');
                logElement.className = 'log-item';
                logElement.innerHTML = `
                    <span style="color: #95a5a6; font-size: 11px;">${log.time}</span>
                    <span style="color: #3498db; font-weight: bold; margin: 0 5px;">[${log.type}]</span>
                    ${log.message}
                `;
                logContainer.appendChild(logElement);
            });
        }
        
        // æ¸…ç©ºäº‹ä»¶æ—¥å¿—
        function clearEventLog() {
            eventLog = [];
            updateEventLogDisplay();
        }
        
        // å±•å¼€æ‰€æœ‰èŠ‚ç‚¹
        function expandAllNodes() {
            const option = chart.getOption();
            option.series[0].initialTreeDepth = 100; // è®¾ç½®ä¸€ä¸ªå¾ˆå¤§çš„æ·±åº¦å€¼
            chart.setOption(option);
            addEventLog('control', 'å±•å¼€äº†æ‰€æœ‰èŠ‚ç‚¹', null);
        }
        
        // æŠ˜å æ‰€æœ‰èŠ‚ç‚¹
        function collapseAllNodes() {
            const option = chart.getOption();
            option.series[0].initialTreeDepth = 0;
            chart.setOption(option);
            addEventLog('control', 'æŠ˜å äº†æ‰€æœ‰èŠ‚ç‚¹', null);
        }
        
        // é‡ç½®é€‰ä¸­çŠ¶æ€
        function resetSelection() {
            selectedNode = null;
            clearNodeHighlights();
            updateNodeDetails({});
            document.querySelector('.node-details h4').innerHTML = `<i>ğŸ”</i> å½“å‰é€‰ä¸­èŠ‚ç‚¹`;
            addEventLog('control', 'é‡ç½®äº†é€‰ä¸­çŠ¶æ€', null);
        }
        
        // æ·»åŠ å­èŠ‚ç‚¹
        function addChildNode() {
            if (!selectedNode) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹');
                return;
            }
            
            const childName = prompt('è¯·è¾“å…¥æ–°å­èŠ‚ç‚¹çš„åç§°:');
            if (!childName) return;
            
            // åˆ›å»ºæ–°èŠ‚ç‚¹
            const newNode = {
                name: childName,
                value: Math.floor(Math.random() * 10) + 1,
                depth: (selectedNode.depth || 0) + 1
            };
            
            // æ·»åŠ åˆ°é€‰ä¸­èŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ—è¡¨
            if (!selectedNode.children) {
                selectedNode.children = [];
            }
            selectedNode.children.push(newNode);
            
            // æ›´æ–°å›¾è¡¨
            chart.setOption({
                series: [{
                    data: [treeData]
                }]
            });
            
            addEventLog('control', `ä¸ºèŠ‚ç‚¹ ${selectedNode.name} æ·»åŠ äº†å­èŠ‚ç‚¹ ${childName}`, selectedNode);
        }
        
        // åˆ é™¤èŠ‚ç‚¹
        function removeNode() {
            if (!selectedNode) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹');
                return;
            }
            
            if (selectedNode.name === 'ä¸­å›½') {
                alert('ä¸èƒ½åˆ é™¤æ ¹èŠ‚ç‚¹');
                return;
            }
            
            if (confirm(`ç¡®å®šè¦åˆ é™¤èŠ‚ç‚¹ "${selectedNode.name}" å—ï¼Ÿ`)) {
                // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œéœ€è¦ä»æ ‘ç»“æ„ä¸­åˆ é™¤èŠ‚ç‚¹
                // æ³¨æ„ï¼šè¿™éœ€è¦é€’å½’æŸ¥æ‰¾å¹¶åˆ é™¤èŠ‚ç‚¹
                addEventLog('control', `åˆ é™¤äº†èŠ‚ç‚¹ ${selectedNode.name}`, selectedNode);
                
                // é‡ç½®é€‰æ‹©
                resetSelection();
            }
        }
        
        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–å›¾è¡¨
            initChart();
            
            // ç»‘å®šæŒ‰é’®äº‹ä»¶
            document.getElementById('clearLogBtn').addEventListener('click', clearEventLog);
            document.getElementById('resetBtn').addEventListener('click', resetSelection);
            document.getElementById('expandAllBtn').addEventListener('click', expandAllNodes);
            document.getElementById('collapseAllBtn').addEventListener('click', collapseAllNodes);
            document.getElementById('highlightPathBtn').addEventListener('click', function() {
                if (selectedNode) {
                    highlightNodePath(selectedNode);
                    addEventLog('control', `é«˜äº®äº†åˆ°èŠ‚ç‚¹ ${selectedNode.name} çš„è·¯å¾„`, selectedNode);
                } else {
                    alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹');
                }
            });
            document.getElementById('selectChildrenBtn').addEventListener('click', function() {
                if (selectedNode) {
                    // è¿™é‡Œå¯ä»¥æ·»åŠ é€‰ä¸­æ‰€æœ‰å­èŠ‚ç‚¹çš„é€»è¾‘
                    addEventLog('control', `é€‰ä¸­äº†èŠ‚ç‚¹ ${selectedNode.name} çš„æ‰€æœ‰å­èŠ‚ç‚¹`, selectedNode);
                } else {
                    alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹');
                }
            });
            document.getElementById('addChildBtn').addEventListener('click', addChildNode);
            document.getElementById('removeNodeBtn').addEventListener('click', removeNode);
            
            // åˆå§‹æ—¥å¿—
            addEventLog('system', 'å›¾è¡¨åˆå§‹åŒ–å®Œæˆ', null);
        });
    </script>
</body>
</html>